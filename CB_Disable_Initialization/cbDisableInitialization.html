<!DOCTYPE HTML>
<meta charset="utf-8"/>
<title>Custom Buttons: Disable Initialization [0.1.1 - 2016-02-02]</title>
<body>
<a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3ECustom%20Buttons%3A%20Disable%20Initialization%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABCFBMVEX////MIgD/ZkT/ZkT/qojMIgD/e1n/ZkT/ZkT9Y0H9aEb/ZkT5Xz32Wjj3Xz35Xz39Y0H/n33xVDL/l3XtTiz/jmz/hGL/YD7SKQfeOhj/cU/OJQPaNBLOJQPRKAbMIgDVLgzYMhDMIgDMIgD/VTPSKQf7YT/QJwX2WjjQJwXQJwXVLgzwUjD7YT/wUjD/aEbbNhT2WjjbNhT7YT/VLgzMIgD/ZkTjQR/wclDkOhj/Xjz0UjD3cU//qojaMhD7f136bErqSyn/Y0H9knDlUC7zTSvzSij+gmDbSCboRyX/hGLiPx39jGrtd1X/VTP8Y0HpSSf/mXf/e1n3ZEL0Wzn9YT/nYkD+hmSUvhNbAAAANXRSTlMAAACAAIAAzioA54JlKucAZQCCAM4AAAAAzgAAgmXnzirngioAZa+vI8ZeI15erwBexq/GxjKab+kAAADMSURBVHheZc9FQsVAEEVREkLU5bu74NIdt+/uwP53QoVpavTumdVd9kiSZAUGY0ZgYQJwlMovz0FwXvIqxQEoYjzdrxBa7aexqABI8u5nNNa0AQ52sgSg+/bXo2Hc4wDZvg5gRrO3XC7tj1lkAqw32zyV9kN+u1kDWJcT/d80fbpYAKXr7SXtcvnpdi0BVJNj2tTr8P2YVAGaLe8X9QuF589vr9UEKPbCuTvBeOLOw14RoNKt1Z3F4bBw6rVuBYAgiE67gVCj3YGZff4PSvQf3NnYYToAAAAASUVORK5CYII%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5B//%20https%3A//github.com/Infocatcher/Custom_Buttons/tree/master/CB_Disable_Initialization%0A%0A//%20Custom%20Buttons%3A%20Disable%20Initialization%20button%20for%20Custom%20Buttons%0A//%20%28code%20for%20%22initialization%22%20section%29%0A%0A//%20%28c%29%20Infocatcher%202012-2013%2C%202016%0A//%20version%200.1.1%20-%202016-02-02%0A%0A//%20Adds%20%22Enable%20initialization%22%20checkbox%20to%20custom%20button%27s%20context%20menu.%0A//%20Only%20for%20test%20purposes%21%0A//%20%22Disabled%22%20mean%20only%20%22if%28true%29%20return%3B%22%20before%20initealization%20code.%0A%0A//%20Note%3A%20button%20itself%20aren%27t%20needed%2C%20this%20is%20just%20way%20to%20execute%20code%20on%20window%20startup.%0A//%20So%20you%20can%20place%20it%20on%20hidden%20toolbar.%0A%0Avar%20toggleEnabledLabel%20%3D%20%28function%28%29%20%7B%0A%09var%20locale%20%3D%20%28function%28%29%20%7B%0A%09%09var%20prefs%20%3D%20%22Services%22%20in%20window%20%26%26%20Services.prefs%0A%09%09%09%7C%7C%20Components.classes%5B%22@mozilla.org/preferences-service%3B1%22%5D%0A%09%09%09%09.getService%28Components.interfaces.nsIPrefBranch%29%3B%0A%09%09if%28%21prefs.getBoolPref%28%22intl.locale.matchOS%22%29%29%20%7B%0A%09%09%09var%20locale%20%3D%20prefs.getCharPref%28%22general.useragent.locale%22%29%3B%0A%09%09%09if%28locale.substr%280%2C%209%29%20%21%3D%20%22chrome%3A//%22%29%0A%09%09%09%09return%20locale%3B%0A%09%09%7D%0A%09%09return%20Components.classes%5B%22@mozilla.org/chrome/chrome-registry%3B1%22%5D%0A%09%09%09.getService%28Components.interfaces.nsIXULChromeRegistry%29%0A%09%09%09.getSelectedLocale%28%22global%22%29%3B%0A%09%7D%29%28%29.match%28/%5E%5Ba-z%5D*/%29%5B0%5D%3B%0A%09if%28locale%20%3D%3D%20%22ru%22%29%0A%09%09return%20%22%u0412%u043A%u043B%u044E%u0447%u0438%u0442%u044C%20%u0438%u043D%u0438%u0446%u0438%u0430%u043B%u0438%u0437%u0430%u0446%u0438%u044E%22%3B%0A%09return%20%22Enable%20initialization%22%3B%0A%7D%29%28%29%3B%0A%0Aconst%20deleteId%20%3D%20%22custombuttons-contextpopup-remove%22%3B%0Aconst%20toggleEnabledId%20%3D%20%22custombuttons-contextpopup-toggleEnabled%22%3B%0Avar%20toggleEnabled%20%3D%20document.getElementById%28toggleEnabledId%29%3B%0Aif%28toggleEnabled%29%0A%09toggleEnabled.parentNode.removeChild%28toggleEnabled%29%3B%0Avar%20deleteItem%20%3D%20document.getElementById%28deleteId%29%3B%0AtoggleEnabled%20%3D%20deleteItem.cloneNode%28true%29%3B%0AtoggleEnabled.id%20%3D%20toggleEnabledId%3B%0AtoggleEnabled.setAttribute%28%22cb_id%22%2C%20toggleEnabledId%29%3B%0AtoggleEnabled.setAttribute%28%22type%22%2C%20%22checkbox%22%29%3B%0AtoggleEnabled.setAttribute%28%22label%22%2C%20toggleEnabledLabel%29%3B%0AtoggleEnabled.setAttribute%28%22oncommand%22%2C%20%22toggleCustomButtonEnabled%28%29%3B%22%29%3B%0A//toggleEnabled.removeAttribute%28%22observes%22%29%3B%20//%20For%20Firefox%203.6%20and%20older%0AdeleteItem.parentNode.insertBefore%28toggleEnabled%2C%20deleteItem%29%3B%0A%0AArray.filter%28%20//%20Process%20already%20cloned%20menu%20items%0A%09document.getElementsByAttribute%28%22observes%22%2C%20deleteItem.getAttribute%28%22observes%22%29%29%2C%0A%09function%28mi%29%20%7B%0A%09%09return%20mi%20%21%3D%20deleteItem%20%26%26%20%28mi.id%20%7C%7C%20%22%22%29.substr%280%2C%20deleteId.length%29%20%3D%3D%20deleteId%3B%0A%09%7D%0A%29.forEach%28function%28deleteItem%2C%20i%29%20%7B%0A%09var%20clone%20%3D%20toggleEnabled.cloneNode%28true%29%3B%0A%09clone.id%20+%3D%20%22-cloned-%22%20+%20i%3B%0A%09deleteItem.parentNode.insertBefore%28clone%2C%20deleteItem%29%3B%0A%7D%29%3B%0A%0A//%20Process%20%23custombuttons-contextpopup-sub%0Aconst%20deleteIdSub%20%3D%20deleteId%20+%20%22-sub%22%3B%0Avar%20deleteItemSub%20%3D%20document.getElementById%28deleteIdSub%29%3B%0Aif%28deleteItemSub%29%20%7B%0A%09var%20clone%20%3D%20toggleEnabled.cloneNode%28true%29%3B%0A%09if%28deleteItemSub.hasAttribute%28%22observes%22%29%29%0A%09%09clone.setAttribute%28%22observes%22%2C%20deleteItemSub.getAttribute%28%22observes%22%29%29%3B%0A%09else%0A%09%09clone.removeAttribute%28%22observes%22%29%3B%0A%09clone.id%20+%3D%20%22-sub%22%3B%0A%09deleteItemSub.parentNode.insertBefore%28clone%2C%20deleteItemSub%29%3B%0A%7D%0A%0AaddEventListener%28%22popupshowing%22%2C%20function%28e%29%20%7B%0A%09var%20popup%20%3D%20e.target%3B%0A%09if%28popup.localName%20%21%3D%20%22menupopup%22%20%7C%7C%20%28popup.id%20%7C%7C%20%22%22%29.substr%280%2C%2014%29%20%21%3D%20%22custombuttons-%22%29%0A%09%09return%3B%0A%09var%20toggleEnabled%20%3D%20popup.getElementsByAttribute%28%22cb_id%22%2C%20toggleEnabledId%29%5B0%5D%3B%0A%09if%28%21toggleEnabled%29%0A%09%09return%3B%0A%09var%20btn%20%3D%20getBtn%28%29%3B%0A%09var%20initCode%20%3D%20btn%20%26%26%20btn.cbInitCode%20%7C%7C%20%22%22%3B%0A%09if%28/%5E%5Cs*%28%3F%3Aif%5Cs*%5C%28true%5C%29%5Cs*%29%3Freturn%28%3F%3A%3B%7C%5Cs*%5Cn%29/.test%28initCode%29%29%0A%09%09toggleEnabled.removeAttribute%28%22checked%22%29%3B%0A%09else%0A%09%09toggleEnabled.setAttribute%28%22checked%22%2C%20%22true%22%29%3B%0A%09if%28/%5E%5Cs*%28%3F%3A%5C/%5C*Initialization%20Code%5C*%5C/%5Cs*%29%3F%24/.test%28initCode%29%29%20//%20Nothing%20to%20do%20%3A%29%0A%09%09toggleEnabled.setAttribute%28%22disabled%22%2C%20%22true%22%29%3B%0A%09else%0A%09%09toggleEnabled.removeAttribute%28%22disabled%22%29%3B%0A%7D%2C%20false%29%3B%0A%0Awindow.toggleCustomButtonEnabled%20%3D%20function%28%29%20%7B%20//%20Should%20be%20global%20to%20work%20in%20cloned%20menus%0A%09var%20btn%20%3D%20getBtn%28%29%3B%0A%09if%28%21btn%29%0A%09%09return%3B%0A%0A%09//%20Trick%20to%20prevent%20%22unreachable%20code%20after%20return%20statement%22%20warning%0A%09const%20disablePrefix%20%3D%20%22if%28true%29%20return%3B%20//%20Disabled%20by%20Disable%20Initialization%20button%5Cn%5Cn%22%3B%0A%09var%20initCode%20%3D%20btn.cbInitCode%3B%0A%09//if%28initCode.substr%280%2C%20disablePrefix.length%29%20%3D%3D%20disablePrefix%29%0A%09//%09initCode%20%3D%20initCode.substr%28disablePrefix.length%29%3B%0A%09if%28/%5E%5Cs*%28%3F%3Aif%5Cs*%5C%28true%5C%29%5Cs*%29%3Freturn%3B%3F%28%3F%3A%5Cs*%5C/%5C/%5B%5E%5Cn%5Cr%5D*%29%3F%5Cn+/.test%28initCode%29%29%0A%09%09initCode%20%3D%20RegExp.rightContext%3B%0A%09else%0A%09%09initCode%20%3D%20disablePrefix%20+%20initCode%3B%0A%0A%09//btn.destroy%28%22update%22%29%3B%0A%09//btn.cbInitCode%20%3D%20initCode%3B%0A%09//btn.setAttribute%28%22cb-init%22%2C%20initCode%29%3B%0A%0A%09var%20link%20%3D%20custombuttons.makeButtonLink%28%22edit%22%2C%20btn.id%29%3B%0A%09var%20cbService%20%3D%20custombuttons.cbService%3B%0A%09var%20param%20%3D%20cbService.getButtonParameters%28link%29%3B%0A%09param%20%3D%20param.wrappedJSObject%20%7C%7C%20param%3B%0A%09param.initCode%20%3D%20initCode%3B%0A%09cbService.installButton%28param%29%3B%0A%0A%09//btn.init%28%29%3B%0A%7D%3B%0Afunction%20getBtn%28%29%20%7B%0A%09var%20btn%20%3D%20custombuttons.popupNode%3B%0A%09if%28%21btn%20%7C%7C%20%28btn.id%20%7C%7C%20%22%22%29.substr%280%2C%2020%29%20%21%3D%20%22custombuttons-button%22%29%0A%09%09return%20null%3B%0A%09return%20btn%3B%0A%7D%0A%0Avar%20style%20%3D%20%27%5C%0A%09@namespace%20url%28%22http%3A//www.mozilla.org/keymaster/gatekeeper/there.is.only.xul%22%29%3B%5Cn%5C%0A%09toolbarbutton%5Bid%5E%3D%22custombuttons-button%22%5D%5Bcb-init%5E%3D%22return%3B%22%5D%3Anot%28%5Bcb-edit-state%5D%29%2C%5Cn%5C%0A%09toolbarbutton%5Bid%5E%3D%22custombuttons-button%22%5D%5Bcb-init%5E%3D%22if%28true%29%20return%3B%22%5D%3Anot%28%5Bcb-edit-state%5D%29%20%7B%5Cn%5C%0A%09%09outline%3A%201px%20dotted%20%21important%3B%5Cn%5C%0A%09%09outline-offset%3A%20-1px%20%21important%3B%5Cn%5C%0A%09%7D%27%3B%0Avar%20styleNode%20%3D%20document.insertBefore%28%0A%09document.createProcessingInstruction%28%0A%09%09%22xml-stylesheet%22%2C%0A%09%09%27href%3D%22%27%20+%20%22data%3Atext/css%2C%22%0A%09%09%09+%20encodeURIComponent%28style%29%20+%20%27%22%20type%3D%22text/css%22%27%0A%09%29%2C%0A%09document.firstChild%0A%29%3B%0A%0Afunction%20destructor%28reason%29%20%7B%0A%09if%28reason%20%3D%3D%20%22update%22%20%7C%7C%20reason%20%3D%3D%20%22delete%22%29%20%7B%0A%09%09styleNode.parentNode.removeChild%28styleNode%29%3B%0A%09%09Array.slice%28document.getElementsByAttribute%28%22cb_id%22%2C%20toggleEnabledId%29%29.forEach%28function%28btn%29%20%7B%0A%09%09%09btn.parentNode.removeChild%28btn%29%3B%0A%09%09%7D%29%3B%0A%09%09delete%20window.toggleCustomButtonEnabled%3B%0A%09%7D%0A%7D%0Aif%28%0A%09typeof%20addDestructor%20%3D%3D%20%22function%22%20//%20Custom%20Buttons%200.0.5.6pre4+%0A%09%26%26%20addDestructor%20%21%3D%20%28%22addDestructor%22%20in%20window%20%26%26%20window.addDestructor%29%0A%29%0A%09addDestructor%28destructor%2C%20this%29%3B%0Aelse%0A%09this.onDestroy%20%3D%20destructor%3B%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*CODE*/%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E"
>Install</a>
| <a href="https://github.com/Infocatcher/Custom_Buttons/tree/master/CB_Disable_Initialization">Source</a>
| <a href="https://github.com/Infocatcher/Custom_Buttons#usage">Instructions</a>
<script type="text/javascript">
var a = document.getElementsByTagName("a")[0];
a.title = document.title;
if(/%3Cimage%3E%3C%21%5BCDATA%5B(data%3A\S+)%5D%5D%3E%3C\/image%3E/.test(a.href)) {
	var icon = decodeURIComponent(RegExp.$1);

	var img = document.createElement("img");
	img.src = icon;
	img.alt = "";
	img.style.verticalAlign = "middle";
	img.style.marginRight = "4px";
	img.style.border = "none";
	a.insertBefore(img, a.firstChild);

	var link = document.createElement("link");
	link.rel = "shortcut icon";
	link.href = icon;
	document.documentElement.insertBefore(link, document.documentElement.firstChild);
}
</script>
<script type="text/javascript" src="https://infocatcher.github.io/Custom_Buttons/viewCustomButton.js"></script>
<script type="text/javascript">
if("viewCustomButtonCode" in window) setTimeout(function() {
	viewCustomButtonCode(a.href);
}, 0);
</script>
</body>