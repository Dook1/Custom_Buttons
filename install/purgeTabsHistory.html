<!DOCTYPE HTML>
<meta charset="utf-8"/>
<title>Purge Tab(s) History [0.3.0.1 - 2013-09-29]</title>
<body>
<a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EPurge%20Tab%28s%29%20History%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAzZJREFUeNqkk19oU1ccx7+596TpTe+9uUkz8lerlWj9hzZZHLO0ulCIzk5RkTyoD4IooqgPE5Th9jDwYaOM+eQeyqZ2A0UYdnuQwZCpQzFip9WYirVWxcbmj01ubpqbP/d6bqZl+roDH849v3vO9/zOl9/PpOs6/s8gpk1WYCP378psMiKwcta5frtvn+uxTbLd58a4ZyRH/+Ypz+mFCYpcr9ehaRrI7OE3o5lYtq7wL+/veBXQ96/eC8+mDzxGfDKdnrx540b85tWrl+V8/jINJY04+44AY/os2NF5SpAF95eLjznmON1SYmSEeH0+IgmC5GtrW9q+ZMmKsdFRWSkWMzSTDIM69cBAg9cpOI7bONEVJCtZD+9saN6Ox2f1RY6D3eHw79izZz8vir1UQGRQrANVKlDRtnh8nkDueRYfOUM0GVPjULlc/k+C1J+mJvCS5F+9Zs1a6sMyBmUNUKiIqnU1SWZezc2Ahx0TmUyDZDI5+21QmJlpmNcZDodrtdo8Bjp+QE2/RYUC5WaV1As1HP7rAE6OfIs2pxOyLDdmA+eTFNjTQ6j+k4RNklxUwE5Q0X+Fpofm7V4UUqAAUcD2mwUb5q/Hp729iEQi2BmLob3KoG26giMnTuDcwAA6WMJQAYZFt/kRpmtPp69NLW76mPeKZwiOR75AZMEn6Ovrw3f9/Th58Ag6VBbbdu1CLptFuLsb9y4MKfk7DxKs1+uFkG15JORa1OpdZdXR9V8J65ZGG4Y1U9e7urpQsLAIbd+K3PVhGNa+GB2Fb+4cy+TQn5PE/bD1rckX7RWH+0N38FBd0zyEYZCZmkK+UMCqYBClUgnmzWvx4vsz4HkeZ7/+5m+zrv/MulwuGP1AKcuFQnE4Htd7enraRVEUHiQSCHd2QlEUGKU7MTEBa3gZzu/9fDhXVQf8pfovbCqVwluKxeLLdDqd++PSJUWr1aomXW9dGAg0G7ePj4/DarUiFov9bk9Nnycl9dRPegam95pLoLgIIW6z2dxus9lC9NDCwcHBdQx9UjQa/ZEW1hVVVa/TfSlK4X0BC6XF6Kk361aO45bT2V+pVIwCGqNPHadrmZI15tcCDACeDGQBwpSmPgAAAABJRU5ErkJggg%3D%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5B//%20https%3A//github.com/Infocatcher/Custom_Buttons/tree/master/Purge_Tabs_History%0A//%20http%3A//infocatcher.ucoz.net/js/cb/purgeTabsHistory.js%0A%0A//%20Purge%20Tab%28s%29%20History%0A//%20%28c%29%20Infocatcher%202009%2C%202011-2013%0A//%20version%200.3.0.1%20-%202013-09-29%0A%0Athis.onclick%20%3D%20function%28e%29%20%7B%0A%09if%28e.button%20%3D%3D%201%20%7C%7C%20e.button%20%3D%3D%200%20%26%26%20%28e.ctrlKey%20%7C%7C%20e.shiftKey%20%7C%7C%20e.altKey%20%7C%7C%20e.metaKey%29%29%0A%09%09this.historyManager.purgeBrowsersHistory%28this.historyManager.visibleBrowsers%29%3B%0A%09else%20if%28e.button%20%3D%3D%200%29%0A%09%09this.historyManager.purgeBrowserHistory%28%29%3B%0A%7D%3B%0A%0Avar%20dummy%20%3D%20function%28%29%20%7B%7D%3B%0Athis.historyManager%20%3D%20%7B%0A%09button%3A%20this%2C%0A%09initialized%3A%20false%2C%0A%09init%3A%20function%28%29%20%7B%0A%09%09if%28this.initialized%29%0A%09%09%09return%3B%0A%09%09this.initialized%20%3D%20true%3B%0A%0A%09%09window.addEventListener%28this.ssTabRestoredEvent%2C%20this%2C%20false%29%3B%0A%09%09window.addEventListener%28%22TabClose%22%2C%20this%2C%20false%29%3B%0A%09%09window.addEventListener%28%22unload%22%2C%20this%2C%20false%29%3B%0A%09%09gBrowser.addProgressListener%28this%29%3B%0A%0A%09%09this.updButtonStateDelayed%28%29%3B%0A%09%09//this.updButtonStateDelayed%281000%29%3B%0A%09%7D%2C%0A%09destroy%3A%20function%28%29%20%7B%0A%09%09if%28%21this.initialized%29%0A%09%09%09return%3B%0A%09%09this.initialized%20%3D%20false%3B%0A%0A%09%09window.removeEventListener%28this.ssTabRestoredEvent%2C%20this%2C%20false%29%3B%0A%09%09window.removeEventListener%28%22TabClose%22%2C%20this%2C%20false%29%3B%0A%09%09window.removeEventListener%28%22unload%22%2C%20this%2C%20false%29%3B%0A%09%09gBrowser.removeProgressListener%28this%29%3B%0A%09%7D%2C%0A%09get%20ssTabRestoredEvent%28%29%20%7B%0A%09%09delete%20this.ssTabRestoredEvent%3B%0A%09%09return%20this.ssTabRestoredEvent%20%3D%20%22@mozilla.org/browser/sessionstore%3B1%22%20in%20Components.classes%0A%09%09%09%3F%20%22SSTabRestored%22%0A%09%09%09%3A%20%22TabOpen%22%3B%0A%09%7D%2C%0A%0A%09handleEvent%3A%20function%28e%29%20%7B%0A%09%09switch%28e.type%29%20%7B%0A%09%09%09case%20%22TabOpen%22%3A%0A%09%09%09case%20%22SSTabRestored%22%3A%0A%09%09%09%09this.updButtonStateDelayed%28250%29%3B%20//%20Slow%20restoring%20during%20browser%20startup%0A%09%09%09break%3B%0A%09%09%09case%20%22TabClose%22%3A%0A%09%09%09%09this.updButtonStateDelayed%28%29%3B%0A%09%09%09break%3B%0A%09%09%09case%20%22unload%22%3A%0A%09%09%09%09this.destroy%28%29%3B%0A%09%09%7D%0A%09%7D%2C%0A%0A%09QueryInterface%3A%20function%28iid%29%20%7B%0A%09%09if%28%0A%09%09%09iid.equals%28Components.interfaces.nsIWebProgressListener%29%0A%09%09%09%7C%7C%20iid.equals%28Components.interfaces.nsISupportsWeakReference%29%0A%09%09%09%7C%7C%20iid.equals%28Components.interfaces.nsISupports%29%0A%09%09%29%0A%09%09%09return%20this%3B%0A%09%09throw%20Components.results.NS_NOINTERFACE%3B%0A%09%7D%2C%0A%09onStateChange%3A%20dummy%2C%0A%09onProgressChange%3A%20dummy%2C%0A%09onLocationChange%3A%20function%28aWebProgress%2C%20aRequest%2C%20aLocation%29%20%7B%0A%09%09this.updButtonStateDelayed%28%29%3B%0A%09%7D%2C%0A%09onStatusChange%3A%20dummy%2C%0A%09onSecurityChange%3A%20dummy%2C%0A%0A%09purgeBrowserHistory%3A%20function%28browser%29%20%7B%0A%09%09if%28%21browser%29%0A%09%09%09browser%20%3D%20gBrowser.selectedBrowser%3B%0A%09%09var%20sh%20%3D%20browser.sessionHistory%0A%09%09%09.QueryInterface%28Components.interfaces.nsISHistory%29%0A%09%09%09.QueryInterface%28Components.interfaces.nsISHistoryInternal%29%3B%0A%09%09var%20count%20%3D%20sh.count%3B%0A%09%09if%28%21count%29%0A%09%09%09return%3B%0A%09%09var%20indx%20%3D%20sh.index%3B%0A%09%09var%20curEntry%20%3D%20indx%20%3E%20-1%20%3F%20sh.getEntryAtIndex%28indx%2C%20false%29%20%3A%20null%3B%0A%09%09sh.PurgeHistory%28count%29%3B%0A%09%09curEntry%20%26%26%20sh.addEntry%28curEntry%2C%20true%29%3B%0A%09%09if%28arguments.length%20%3C%3D%201%29%0A%09%09%09this.upd%28%29%3B%0A%09%7D%2C%0A%09purgeBrowsersHistory%3A%20function%28browsers%29%20%7B%0A%09%09browsers.forEach%28this.purgeBrowserHistory%2C%20this%29%3B%0A%09%09this.upd%28%29%3B%0A%09%7D%2C%0A%0A%09upd%3A%20function%28%29%20%7B%0A%09%09this.forceSaveSession%28%29%3B%0A%09%09this.updButtonState%28%29%3B%0A%09%09this.updUI%28%29%3B%0A%09%7D%2C%0A%09updUI%3A%20function%28%29%20%7B%0A%09%09if%28%22UpdateBackForwardCommands%22%20in%20window%29%20//%20Firefox%0A%09%09%09UpdateBackForwardCommands%28gBrowser.webNavigation%29%3B%0A%09%09else%20//%20SeaMonkey%0A%09%09%09UpdateBackForwardButtons%28%29%3B%0A%09%7D%2C%0A%09get%20visibleBrowsers%28%29%20%7B%0A%09%09if%28%22visibleTabs%22%20in%20gBrowser%29%20%7B%0A%09%09%09return%20gBrowser.visibleTabs.map%28function%28tab%29%20%7B%0A%09%09%09%09return%20tab.linkedBrowser%3B%0A%09%09%09%7D%29%3B%0A%09%09%7D%0A%09%09return%20gBrowser.browsers%3B%0A%09%7D%2C%0A%09updButtonState%3A%20function%28%29%20%7B%0A%09%09this.button.disabled%20%3D%20%21this.visibleBrowsers.some%28function%28browser%29%20%7B%0A%09%09%09return%20browser%20%26%26%20browser.sessionHistory%20%26%26%20browser.sessionHistory.count%20%3E%201%3B%0A%09%09%7D%29%3B%0A%09%7D%2C%0A%09updButtonStateDelayed%3A%20function%28delay%29%20%7B%0A%09%09setTimeout%28function%28_this%29%20%7B%0A%09%09%09_this.updButtonState%28%29%3B%0A%09%09%7D%2C%20delay%20%7C%7C%200%2C%20this%29%3B%0A%09%7D%2C%0A%09_forceSaveSessionTimer%3A%200%2C%0A%09forceSaveSession%3A%20function%28%29%20%7B%0A%09%09const%20key%20%3D%20%22custombuttonsPurgeTabHistoryForceSaveSession%22%3B%0A%09%09var%20ss%20%3D%20%28%20//%20Firefox%20or%20SeaMonkey%0A%09%09%09Components.classes%5B%22@mozilla.org/browser/sessionstore%3B1%22%5D%0A%09%09%09%7C%7C%20Components.classes%5B%22@mozilla.org/suite/sessionstore%3B1%22%5D%0A%09%09%29.getService%28Components.interfaces.nsISessionStore%29%3B%0A%09%09ss.setWindowValue%28window%2C%20key%2C%20Date.now%28%29%29%3B%0A%09%09clearTimeout%28this._forceSaveSessionTimer%29%3B%0A%09%09this._forceSaveSessionTimer%20%3D%20setTimeout%28function%28%29%20%7B%0A%09%09%09ss.deleteWindowValue%28window%2C%20key%29%3B%0A%09%09%7D%2C%2020e3%29%3B%0A%09%7D%0A%7D%3B%0A%0Athis.onDestroy%20%3D%20function%28%29%20%7B%0A%09this.historyManager.destroy%28%29%3B%0A%7D%3B%0Athis.historyManager.init%28%29%3B%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*CODE*/%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E"
>Install</a>
| <a href="https://github.com/Infocatcher/Custom_Buttons/tree/master/Purge_Tabs_History">Source</a>
| <a href="https://github.com/Infocatcher/Custom_Buttons#usage">Instructions</a>
<script type="text/javascript">
var a = document.getElementsByTagName("a")[0];
a.title = document.title;
if(/%3Cimage%3E%3C%21%5BCDATA%5B(data%3A\S+)%5D%5D%3E%3C\/image%3E/.test(a.href)) {
	var icon = decodeURIComponent(RegExp.$1);

	var img = document.createElement("img");
	img.src = icon;
	img.alt = "";
	img.style.verticalAlign = "middle";
	img.style.marginRight = "4px";
	img.style.border = "none";
	a.insertBefore(img, a.firstChild);

	var link = document.createElement("link");
	link.rel = "shortcut icon";
	link.href = icon;
	document.documentElement.insertBefore(link, document.documentElement.firstChild);
}
</script>
<script type="text/javascript" src="http://infocatcher.github.io/Custom_Buttons/viewCustomButton.js"></script>
<script type="text/javascript">
if("viewCustomButtonCode" in window) setTimeout(function() {
	viewCustomButtonCode(a.href);
}, 0);
</script>
</body>